// Generated by CoffeeScript 1.10.0
(function() {
  $(function() {
    var apply;
    $('[data-toggle="tooltip"]').tooltip();
    stickFooter();
    $('.alert').on('click', function() {
      return $(this).fadeOut();
    });
    $('input[type="checkbox"]').bootstrapSwitch({
      size: 'mini',
      onColor: 'info',
      onSwitchChange: function(event, state) {
        $(this).bootstrapSwitch('toggleIndeterminate');
        return $.ajax({
          url: 'switch/',
          type: 'post',
          dataType: 'json',
          data: {
            state: state,
            pk: $(this).data('pk')
          },
          success: (function(_this) {
            return function(data) {
              if (data.msg === 'okay') {
                return $(_this).bootstrapSwitch('state', state, true);
              } else {
                return $(_this).bootstrapSwitch('state', !state, true);
              }
            };
          })(this)
        });
      }
    });
    $('#modal-container').on('show.bs.modal', function(event) {
      var pk;
      pk = $(event.relatedTarget).data('pk');
      $('#modalTitle').text($(event.relatedTarget).text());
      $('#submit').data('pk', pk);
      $('#flagHolder').show();
      $('.alert').hide();
      $('#flagHolder').text('');
      return $.ajax({
        url: '/challenge/detail/',
        type: 'post',
        dataType: 'json',
        data: {
          pk: pk
        },
        success: function(data) {
          if (data.msg === 'okay') {
            return $('.modal-body').html(data.content);
          } else {
            return false;
          }
        }
      });
    });
    $('#submit').on('click', function() {
      var pk;
      pk = $(this).data('pk');
      return $.ajax({
        url: '/challenge/submit/',
        type: 'post',
        dataType: 'json',
        data: {
          flag: $('#flagHolder').val(),
          pk: pk
        },
        success: function(data) {
          $('flagHolder').hide();
          $('.alert').hide();
          if (data.msg === 'okay') {
            return $('.alert-success').fadeIn();
          } else if (data.msg === 'fail') {
            return $('.alert-danger').fadeIn();
          }
        }
      });
    });
    apply = $('#teamCont').data('pk');
    if (apply !== -1) {
      $('button.btn-default').hide();
      $("button[id='apply-" + apply + "']").siblings('p.text-danger').show();
    }
    $('button[id^="apply-"]').on('click', function() {
      var pk;
      pk = ($(this).attr('id')).substr(6);
      return $.ajax({
        url: '/group/apply/',
        type: 'post',
        dataType: 'json',
        data: {
          pk: pk
        },
        success: (function(_this) {
          return function(data) {
            if (data.msg === 'okay') {
              $('button.btn-default').hide();
              $('#applySuccess').fadeIn();
              $(_this).siblings('p.text-danger').fadeIn();
              return window.setTimeout("$('#applySuccess').fadeOut()", 1000);
            } else {
              $('#applyFail').fadeIn();
              return window.setTimeout("$('#applyFail').fadeOut()", 1000);
            }
          };
        })(this)
      });
    });
    return $('#withdrawBtn').on('click', function() {
      return $.ajax({
        url: '/group/withdraw/',
        type: 'post',
        dataType: 'json',
        success: function(data) {
          $('p.text-danger').hide();
          $('button.btn-default').fadeIn();
          $('#withdrawSuccess').fadeIn();
          return window.setTimeout("$('#withdrawSuccess').fadeOut()", 1000);
        }
      });
    });
  });

}).call(this);
