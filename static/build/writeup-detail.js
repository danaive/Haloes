// Generated by CoffeeScript 1.10.0
(function() {
  $(function() {
    var editor, toolbar;
    $('a[href$="writeup/"]').addClass('current');
    $('[data-toggle="tooltip"]').tooltip();
    $('#writeupHolder').html($('#writeupHolder').text());
    toolbar = ['bold', 'italic', 'strikethrough', '|', 'ol', 'ul', 'blockquote', 'code', 'table', '|', 'link', 'hr'];
    Simditor.locale = 'en-US';
    editor = new Simditor({
      textarea: $('#editor'),
      toolbar: toolbar,
      toolbarFloat: false
    });
    $('p.marked').each(function() {
      return $(this).html($(this).text());
    });
    $('#submitBtn').on('click', function() {
      if (editor.getValue()) {
        return $.ajax({
          url: '/writeup/comment/',
          type: 'post',
          dataType: 'json',
          data: {
            content: editor.getValue(),
            writeup: $('#likestar').data('pk'),
            reply: 0
          },
          success: function(data) {
            if (data.msg === 'okay') {
              return location.href = '';
            }
          }
        });
      }
    });
    $('button.reply').on('click', function() {
      try {
        editor2.destroy();
      } catch (undefined) {}
      $(this).parent().append('<textarea style="display: none;"></textarea>');
      return window.editor2 = new Simditor({
        textarea: $(this).siblings('textarea'),
        toolbar: toolbar,
        toolbarFloat: false
      });
    });
    $('button.cancel').on('click', function() {
      editor2.destroy();
      $(this).hide().siblings('button').hide();
      return $(this).siblings('button.reply').show();
    });
    $('button.submit').on('click', function() {
      var pk;
      pk = $(this).data('focus');
      if (editor2.getValue()) {
        return $.ajax({
          url: '/writeup/comment/',
          type: 'post',
          dataType: 'json',
          data: {
            content: editor2.getValue(),
            writeup: $('#likestar').data('pk'),
            reply: pk
          },
          success: function(data) {
            if (data.msg === 'okay') {
              return location.href = '';
            }
          }
        });
      }
    });
    if ($('#likestar').data('like')) {
      $('button[data-original-title="like"]').hide();
    } else {
      $('button[data-original-title="unlike"]').hide();
    }
    if ($('#likestar').data('star')) {
      $('button[data-original-title="star"]').hide();
    } else {
      $('button[data-original-title="unstar"]').hide();
    }
    $('button[data-original-title="cancel"]').hide();
    $('button[title]').on('click', function() {
      var state;
      state = $(this).attr('data-original-title');
      $(this).attr('disabled', 'disabled');
      return $.ajax({
        url: (state.substr(-4)) + "/",
        type: 'post',
        dataType: 'json',
        success: function(data) {
          if (data.msg === 'okay') {
            $("button[data-original-title$='" + (state.substr(-4)) + "']").toggle();
            return $('button[title]').removeAttr('disabled');
          }
        }
      });
    });
    return stickFooter();
  });

}).call(this);
