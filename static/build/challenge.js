// Generated by CoffeeScript 1.10.0
(function() {
  $(function() {
    var PAGE_ITEM_COUNT, total;
    $('a[href$="challenge/"]').addClass('current');
    $('[data-toggle="tooltip"]').tooltip();
    $('input[type="checkbox"]').bootstrapSwitch({
      size: 'mini',
      onColor: 'info',
      onSwitchChange: function(event, state) {
        $(this).bootstrapSwitch('toggleIndeterminate');
        return $.ajax({
          url: 'switch/',
          type: 'post',
          dataType: 'json',
          data: {
            state: state,
            pk: $(this).data('pk')
          },
          success: (function(_this) {
            return function(data) {
              if (data.msg === 'okay') {
                return $(_this).bootstrapSwitch('state', state, true);
              } else {
                return $(_this).bootstrapSwitch('state', !state, true);
              }
            };
          })(this)
        });
      }
    });
    PAGE_ITEM_COUNT = 15;
    total = 0;
    $('tr.ALL').each(function() {
      if (($(this).data('state')) === 0) {
        $(this).addClass('Attempted');
      }
      total += 1;
      if (total <= PAGE_ITEM_COUNT) {
        return $(this).show();
      }
    });
    stickFooter();
    $('[id^="btn"]').on('click', function() {
      var cate, cnt;
      $('tr.ALL').hide();
      $('#cont').attr('data-page', 0);
      cate = ($(this).attr('id')).substr(3);
      $('#cont').attr('data-cate', cate);
      cnt = 0;
      $("tr.ALL." + cate).each(function() {
        cnt += 1;
        if (cnt <= PAGE_ITEM_COUNT) {
          return $(this).show();
        }
      });
      return stickFooter();
    });
    $('[id^="pager"]').on('click', function() {
      var cate, cnt, page;
      total = $('tr.ALL').length;
      page = $('#cont').data('page');
      cate = $('#cont').data('cate');
      if ('Next' === ($(this).attr('id')).substr(5)) {
        if (page + PAGE_ITEM_COUNT >= total) {
          return;
        }
        page += PAGE_ITEM_COUNT;
      } else {
        if (page < PAGE_ITEM_COUNT) {
          return;
        }
        page -= PAGE_ITEM_COUNT;
      }
      $('tr.ALL').hide();
      $('#cont').attr('data-page', page);
      cnt = 0;
      $("tr.ALL." + cate).each(function() {
        cnt += 1;
        if ((page < cnt && cnt <= page + PAGE_ITEM_COUNT)) {
          return $(this).show();
        }
      });
      return stickFooter();
    });
    $('i.fa-lightbulb-o').on('click', function() {
      var pk;
      pk = $(this).data('pk');
      return $.ajax({
        url: 'drop-attempt/',
        type: 'post',
        dataType: 'json',
        data: {
          pk: pk
        },
        success: (function(_this) {
          return function(data) {
            if (data.msg === 'okay') {
              return $(_this).hide();
            }
          };
        })(this)
      });
    });
    $('a[href^="#mod-"]').on('click', function() {
      var pk;
      pk = ($(this).attr('href')).substr(5);
      $('#modalTitle').text($(this).text());
      $('#submit').attr('data-pk', pk);
      $('#flagHolder').show();
      $('.alert').hide();
      return $.ajax({
        url: 'get-challenge/',
        type: 'post',
        dataType: 'json',
        data: {
          pk: pk
        },
        success: function(data) {
          if (data.msg === 'okay') {
            $('.modal-body').html(data.content);
            return $('#toggleModal').click();
          } else {
            return false;
          }
        }
      });
    });
    return $('#submit').on('click', function() {
      var pk;
      pk = $(this).data('pk');
      return $.ajax({
        url: 'submit/',
        type: 'post',
        dataType: 'json',
        data: {
          flag: $('#flagHolder').val(),
          pk: pk
        },
        success: function(data) {
          $('flagHolder').hide();
          if (data.msg === 'okay') {
            return $('.alert-success').fadeIn();
          } else if (data.msg === 'fail') {
            return $('.alert-danger').fadeIn();
          }
        }
      });
    });
  });

}).call(this);
